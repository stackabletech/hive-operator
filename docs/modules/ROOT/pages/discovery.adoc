:clusterName: simple-hive-derby
:namespace: stackable
:metastorePort: 9083
:roleGroup: default

= Discovery Profiles

The Stackable Operator for Apache Hive creates a single discovery profile that allows access to the Hive metastore which is published into the Kubernetes cluster as a
https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#configmap-v1-core[`ConfigMap`] object.

== Profiles

Given the following Hive cluster:

[subs="attributes"]
----
apiVersion: hive.stackable.tech/v1alpha1
kind: HiveCluster
metadata:
  name: {clusterName} # <1>
  namespace: {namespace} # <2>
spec:
  metastore:
    roleGroups:
      {roleGroup}:
  [...]
----
<1> Name of the Hive cluster which is the name of the `ConfigMap` created for this discovery profile.
<2> Namespace of the `ConfigMap` created for this discovery profile.

The published `ConfigMap` name and namespace are equal to the cluster name and namespace. In this case `{namespace}/{clusterName}`.

=== Default

This profile allows access to the Hive cluster from inside the Kubernetes cluster, and connects directly to the metastore NodePort `Service`.

== Contents

The discovery profile contains the following fields where `{clusterName}` represents the name, `{namespace}` the namespace of the cluster and `{roleGroup}` the role group of the `metastore` role:

`HIVE`::
====
Contains the thrift protocol connection string for the Hive cluster to connect to the metastore:
[subs="attributes"]
  thrift://{clusterName}-metastore-{roleGroup}-0.{clusterName}-metastore-{roleGroup}.{namespace}.svc.cluster.local:{metastorePort}

or

[subs="attributes"]
  thrift://{clusterName}-metastore-{roleGroup}-0.{clusterName}-metastore-{roleGroup}.{namespace}.svc.cluster.local:{metastorePort}
  thrift://{clusterName}-metastore-{roleGroup}-1.{clusterName}-metastore-{roleGroup}.{namespace}.svc.cluster.local:{metastorePort}

for the role group `replicas` greater than one (two in this case), which should be avoided since the metastore instances do not sync between each other.
====
